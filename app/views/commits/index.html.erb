<div class="grid-container">
  <h1 class="font-heading-xl margin-top-0 margin-bottom-4">
    Recent Commits from <%= @commits.first&.repo_owner %>/<%= @commits.first&.repo_name %>
  </h1>

  <% if @commits.empty? %>
    <div class="usa-alert usa-alert--warning">
      <div class="usa-alert__body">
        <p class="usa-alert__text">No commits available at this time.</p>
      </div>
    </div>
  <% else %>
    <div class="grid-row grid-gap">
      <% @commits.each do |commit| %>
        <div class="margin-bottom-4">
          <div class="usa-card">
            <div class="usa-card__container">
              <header class="usa-card__header">
                <h2 class="usa-card__heading">
                  <%= link_to commit.short_message, commit.url, 
                        class: "usa-link", 
                        target: "_blank",
                        rel: "noopener noreferrer" %>
                </h2>
              </header>
              <div class="usa-card__body">
                <table class="usa-table width-full">
                  <tbody>
                    <tr>
                      <td class="text-bold">Repository:</td>
                      <td><%= commit.repo_owner %>/<%= commit.repo_name %></td>
                    </tr>
                    <tr>
                      <td class="text-bold">Author:</td>
                      <td><%= commit.author_name %></td>
                    </tr>
                    <tr>
                      <td class="text-bold">Date:</td>
                      <td><%= commit.formatted_date %></td>
                    </tr>
                    <tr>
                      <td class="text-bold">SHA:</td>
                      <td class="font-mono-2xs"><%= commit.sha %></td>
                    </tr>
                  </tbody>
                </table>
                <div class="margin-top-3">
                  <%= turbo_frame_tag "#{commit.metadata.id}_jira_tickets", 
                    src: commit_metadatum_jira_tickets_path(commit.metadata),
                    loading: :lazy do %>
                    <div class="usa-alert usa-alert--info">
                      <div class="usa-alert__body">
                        <p class="usa-alert__text">Loading Jira tickets...</p>
                      </div>
                    </div>
                  <% end %>
                </div>
                <div class="margin-top-3">
                  <% if commit.metadata.comments.any? %>
                    <table class="usa-table width-full margin-top-2">
                      <colgroup>
                        <col style="width: 60%">
                        <col style="width: 20%">
                        <col style="width: 20%">
                      </colgroup>
                      <thead>
                        <tr>
                          <th scope="col">Comment</th>
                          <th scope="col">Author</th>
                          <th scope="col">Posted</th>
                        </tr>
                      </thead>
                      <tbody id="commit_<%= commit.metadata.id %>_comments">
                        <%= render partial: "commit_comments/comment", collection: commit.metadata.comments %>
                      </tbody>
                    </table>
                  <% end %>

                  <div id="commit_<%= commit.metadata.id %>_new_comment">
                    <%= link_to "Add Comment", 
                        new_commit_metadatum_commit_comment_path(commit.metadata),
                        class: "usa-button",
                        data: { turbo_stream: true } %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
